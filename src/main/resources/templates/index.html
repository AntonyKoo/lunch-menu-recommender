<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>í•œì†¥ë„ì‹œë½ ë©”ë‰´ ì¶”ì²œ</title>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS ë§í¬ ì¶”ê°€ -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- ì¶”ê°€ CSS íŒŒì¼ ë§í¬ -->
    <!--    <link rel="stylesheet" href="styles/main.css">-->
    <style>
        /* ì»¨ë² ì´ì–´ ë²¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        .menu-conveyor {
            white-space: nowrap;
            overflow: hidden;
            position: relative;
        }

        .menu-item {
            display: inline-block;
            padding: 10px;
            margin-right: 20px;
        }

        /* ì»¨ë² ì´ì–´ ë²¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes conveyor {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        .menu-conveyor .menu-item {
            animation: conveyor 10s linear infinite;
        }

        /* ìˆ˜ì •ëœ CSS */
        .btn-group {
            /* ë²„íŠ¼ ê·¸ë£¹ì„ ìˆ˜í‰ìœ¼ë¡œ ì •ë ¬ */
            display: flex;
            justify-content: space-between; /* ê°€ë¡œ ë°©í–¥ì— ì—¬ë°±ì„ ê³ ë¥´ê²Œ ë°°ë¶„ */
            align-items: center; /* ì„¸ë¡œ ë°©í–¥ ì¤‘ì•™ ì •ë ¬ */
            width: 33.33%; /* ì „ì²´ ë„ˆë¹„ì˜ 1/3ë§Œí¼ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
            margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ */
        }

        .btn {
            /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” */
            font-size: 1rem; /* ê¸°ë³¸ í°íŠ¸ í¬ê¸°ë¡œ ì„¤ì • */
            width: auto; /* ë²„íŠ¼ì´ ë¶€ëª¨ ìš”ì†Œì˜ ë„ˆë¹„ë¥¼ ê°€ë“ ì±„ìš°ë„ë¡ ì„¤ì • */
            border-radius: 5px; /* ë²„íŠ¼ì˜ ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ ë§Œë“¦ */
        }

        /* ë” í° í™”ë©´ì—ì„œëŠ” ë²„íŠ¼ í¬ê¸°ë¥¼ ë” í¬ê²Œ ë§Œë“­ë‹ˆë‹¤ */
        @media (min-width: 768px) {
            .btn {
                /* min-width ì†ì„± ì‚­ì œí•˜ì—¬ ë²„íŠ¼ í¬ê¸°ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì ˆ */
                margin: 0 10px; /* ì¢Œìš° ê°„ê²©ì„ 10pxë¡œ ì„¤ì • */
            }
        }
    </style>
</head>
<body>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">ë¡œê·¸ì¸</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- ë¡œê·¸ì¸ í¼ -->
                <form id="loginForm" th:action="@{/login}" method="post">
                    <!-- ì˜ëª»ëœ ë¡œê·¸ì¸ ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆì„ ë•Œ -->
                    <div th:if="${param.error}">
                        <div class="alert alert-danger">
                            ì‚¬ìš©ìID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.
                        </div>
                    </div>
                    <div class="form-group">
                        <label th:for="email">ì´ë©”ì¼</label>
                        <input type="text" class="form-control" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." id="loginEmail" name="email"
                               required>
                    </div>
                    <div class="form-group">
                        <label th:for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”." id="loginPassword"
                               name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                </form>
                <div id="loggedInUser" style="display: none;">
                    <span id="signinUsername"></span>ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.
                    <button id="logoutBtn" sec:authorize="isAuthenticated()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <!-- íšŒì›ê°€ì… í¼ -->
                <form id="signupForm" style="display: none;" th:action="@{/members/new}" method="post"
                      th:object="${memberFormDto}">
                    <!--                    <div th:replace="~{form_errors :: formErrorsFragment}"></div>-->
                    <div class="form-group">
                        <label th:for="username" class="form-label">ì‚¬ìš©ì ID</label>
                        <input type="text" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." required>
                    </div>
                    <div class="form-group">
                        <label th:for="email" class="form-label">ì´ë©”ì¼</label>
                        <input type="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label th:for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ê°€ì…í•˜ê¸°</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="showLogin">ë¡œê·¸ì¸</button>
                <button type="button" class="btn btn-primary" id="showSignup">íšŒì›ê°€ì…</button>
            </div>
        </div>
    </div>
</div>


<!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
<div class="container mt-5">
    <!-- í˜ì´ì§€ ì œëª© -->
    <h1 class="text-center mb-4">í•œì†¥ë„ì‹œë½ ë©”ë‰´ ì¶”ì²œ</h1>

    <!-- ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="text-center mb-4">
        <div class="btn-group" role="group">
            <!--            <button type="button" class="btn btn-primary mr-2" data-toggle="modal" data-target="#loginModal">ë¡œê·¸ì¸</button>-->
            <button type="button" class="btn btn-info rounded-pill btn-block" data-toggle="modal" data-target="#loginModal">ë¡œê·¸ì¸</button>
            <form th:action="@{/api/v1/recommend/menu}" method="get" style="display: inline;">
                <button type="submit" class="btn btn-success mr-2 rounded-pill btn-block" id="menuRecommendRequestBtn">ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
            </form>
            <button type="button" class="btn btn-info rounded-pill btn-block" data-toggle="modal" data-target="#menuModal">ë©”ë‰´ ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>


    <!-- ì¶”ì²œ ë©”ë‰´ ì¹´ë“œ -->
    <div class="text-center">
        <div class="card mt-3" th:if="${recommendedMenu}">
            <!--    <div class="card mt-3" th:if="${recommendedMenu}">-->
            <!-- th:if= ëŠ” í•´ë‹¹ ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ê³  ë¹ˆ ê°’ì´ ì•„ë‹ë•Œë§Œ í•´ë‹¹ ì˜ì—­ì„ í‘œì‹œí•´ì¤€ë‹¤ê³  í•¨. ê·¸ë˜ì„œ unlessë¡œ ë³€ê²½-->
            <div class="card-header">
                <h5>ì¶”ì²œ ë©”ë‰´</h5>
            </div>
            <div class="card-body d-flex align-items-center justify-content-center">
                <div class="card" style="width: 270px; height: 335px;">
                    <img class="card-img-top2" th:src="@{/images/{imageName}(imageName=${recommendedMenu.imagePath})}"
                         style="width: 100%; height: 230px; object-fit: cover;" alt="Menu Image">
                    <div class="card-body" style="max-height: calc(100% - 105px); overflow: auto;">
                        <h5 class="card-title2" th:text="${recommendedMenu.name}"></h5>
                        <p class="card-text.price">ê°€ê²©: <span th:text="${recommendedMenu.price}"></span>ì›</p>
                        <p class="card-text.review">ë¦¬ë·°: <span th:text="${recommendedMenu.review}"></span></p>
                        <!--                        <p class="card-text.review" th:text="${recommendedMenu.review}"></p>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card mt-3" th:unless="${recommendedMenu}">
        <!--    <div class="card mt-3" th:if="${recommendedMenu}">-->
        <!-- th:if= ëŠ” í•´ë‹¹ ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ê³  ë¹ˆ ê°’ì´ ì•„ë‹ë•Œë§Œ í•´ë‹¹ ì˜ì—­ì„ í‘œì‹œí•´ì¤€ë‹¤ê³  í•¨. ê·¸ë˜ì„œ unlessë¡œ ë³€ê²½-->
        <div class="card-header">
            <h5>ì¶”ì²œ ë©”ë‰´</h5>
        </div>
        <div class="card-body">
            <p class="card-title">ì¶”ì²œ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.ğŸ¥²</p>
        </div>
    </div>

    <!-- ë“±ë¡ëœ ëª¨ë“  ë©”ë‰´ -->
    <div class="mt-4">
        <div class="card-header">
            <h5>ë“±ë¡ëœ ë©”ë‰´</h5>
        </div>
        <div class="menu-conveyor row" th:if="${menuList}">
            <!-- ë©”ë‰´ ì•„ì´í…œ(ì¹´ë“œ)ë“¤ -->
            <div th:each="menu, menuStat : ${menuList}" class="col-md-3 mb-2 menu-item"
                 style="animation-delay: [[${menuStat.index * 0.5}]]s;">
                <div class="card" style="width: 270px; height: 335px;">
                    <img class="card-img-top" th:src="|data:image/jpeg;base64,${menu.imagePath}|" alt="Menu Image"
                         style="width: 100%; height:
                230px; object-fit: cover;">
                    <!--                <img class="card-img-top" th:src="@{/images/} + ${menu.imagePath}" alt="Menu Image">-->
                    <!--                <img class="card-img-top" th:if="${menu.imagePath == null or !T(java.nio.file.Files).exists(T(org.springframework.util.ResourceUtils).getFile('classpath:/images/' + ${menu.imagePath}))}" th:src="@{/images/default.jpeg}" alt="Default Image">-->
                    <div class="card-body" style="max-height: calc(100% - 105px); overflow: auto;">
                        <!-- menu name -->
                        <h5 class="card-title" th:text="${menu.name}"></h5>
                        <!-- price -->
                        <p class="card-text">ê°€ê²©: <span th:text="${menu.price}">ì›</span></p>
                        <!-- review -->
                        <!--                        <p class="card-text" th:text="${menu.review}"></p>-->
                        <p class="card-text">ë¦¬ë·°: <span th:text="${menu.review}"></span></p>
                    </div>
                </div>
                <!-- ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ì„ ë•Œ -->
                <div th:unless="${menuList}">
                    <p>ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.ğŸ¥²</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ë©”ë‰´ ë“±ë¡ ëª¨ë‹¬ -->
<div class="modal fade" id="menuModal" tabindex="-1" role="dialog" aria-labelledby="menuModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="menuModalLabel">ë©”ë‰´ ë“±ë¡í•˜ê¸°</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- ë‹¨ì¼ ë©”ë‰´ ë“±ë¡ í¼ -->
                <div id="singleMenuForm">
                    <h2>ë‹¨ì¼ ë©”ë‰´ ë“±ë¡í•˜ê¸°</h2>
                    <form id="menuForm">
                        <!-- ë©”ë‰´ ì •ë³´ ì…ë ¥ í•„ë“œ -->
                        <div class="form-group">
                            <label for="menuName">ë©”ë‰´ ì´ë¦„:</label>
                            <input type="text" class="form-control" id="menuName" name="menuName" required>
                        </div>
                        <!-- ê°€ê²© ì…ë ¥ í•„ë“œ -->
                        <div class="form-group">
                            <label for="menuPrice">ê°€ê²©:</label>
                            <input type="number" class="form-control" id="menuPrice" name="menuPrice" required>
                        </div>
                        <!-- ë¦¬ë·° ì…ë ¥ í•„ë“œ -->
                        <div class="form-group">
                            <label for="menuReview">ë¦¬ë·°:</label>
                            <textarea class="form-control" id="menuReview" name="menuReview" rows="3"
                                      maxlength="255"></textarea>
                        </div>
                        <!-- ì´ë¯¸ì§€ ë“±ë¡ ë²„íŠ¼ -->
                        <div class="row mb-3">
                            <div class="col">
                                <div class="form-group">
                                    <label for="image">ì´ë¯¸ì§€ ë“±ë¡í•˜ê¸°:</label>
                                    <label for="image" class="btn btn-primary btn-file">
                                        ì´ë¯¸ì§€ ì„ íƒí•˜ê¸° <input type="file" class="form-control-file" id="image"
                                                        name="menuImage" accept="image/*" required
                                                        style="display: none;">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- ì €ì¥í•˜ê¸°, ì—¬ëŸ¬ ë©”ë‰´ ë“±ë¡í•˜ê¸°, ë‹«ê¸° ë²„íŠ¼ -->
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">ì—¬ëŸ¬ ë©”ë‰´ ë“±ë¡í•˜ê¸°</button>
                    <div>
                        <button type="button" class="btn btn-primary mr-2" id="saveMenuBtn">ì €ì¥í•˜ê¸°</button>
                        <button type="button" class="btn btn-secondary" id="closeModalBtn">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© ë° jQuery ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!--    // "ë‹¨ì¼ ë©”ë‰´ ë“±ë¡í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°-->
<!--        // ë‹¨ì¼ ë©”ë‰´ ë“±ë¡ í¼ì„ ë³´ì—¬ì¤Œ-->
<script>
    document.getElementById('showSingleMenuForm').addEventListener('click', function() {
        $('#singleMenuForm').show();
    });
</script>

<script>
    // "ë‹«ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
    document.getElementById('closeModalBtn').addEventListener('click', function() {
        $('#menuModal').modal('hide');
    });
</script>

<!-- ë©”ë‰´ ë“±ë¡í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í´ë¦­í•˜ë©´ POST ìš”ì²­ì„ ë³´ë‚´ëŠ” ì½”ë“œ-->
<!-- JSë¡œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬, fetch APIë¡œ POST ìš”ì²­ ë³´ë‚´ê¸°-->
<!-- JavaScript ì½”ë“œ ì¶”ê°€ -->
<script>
    // ì €ì¥í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ POST ìš”ì²­ ë³´ë‚´ê¸°
    document.getElementById('saveMenuBtn').addEventListener('click', function() {
        // ì´ë¯¸ì§€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        var imageFile = document.getElementById('image').files[0];

        // ì´ë¯¸ì§€ íŒŒì¼ì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (imageFile) {
            // ë©”ë‰´ ì •ë³´ë¥¼ FormData ê°ì²´ì— ì¶”ê°€
            var formData = new FormData();
            formData.append('imageFile', imageFile);
            formData.append('name', document.getElementById('menuName').value);
            formData.append('price', document.getElementById('menuPrice').value);
            formData.append('review', document.getElementById('menuReview').value);

            // POST ìš”ì²­ ë³´ë‚´ê¸°, FormDataë¡œ ì´ë¯¸ì§€ íŒŒì¼ì„ ì „ì†¡í•  ë•Œ ì¼ë°˜ì ìœ¼ë¡œ í—¤ë”ë¥¼ ì¶”ê°€í•˜ì§€ X
            fetch('/api/v1/register/menu', {
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(data => {
                // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°›ì•˜ì„ ë•Œì˜ ì²˜ë¦¬ ì‘ì„±
                console.log('Menu registered:', data);
                // ëª¨ë‹¬ ë‹«ê¸°
                $('#menuModal').modal('hide');
            })
            .catch(error => {
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì˜ ì²˜ë¦¬ ì‘ì„±
                console.error('Error registering menu:', error);
                // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ë“±ì˜ ì¶”ê°€ ì‘ì—… ê°€ëŠ¥
            });
        } else {
            // ì´ë¯¸ì§€ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš°, ì˜ˆì™¸ì²˜ë¦¬
            console.error('No image file selected');
        }
    });
</script>
<script>
    document.getElementById("showSignup").addEventListener("click", function () {
        document.getElementById("loginModalLabel").innerText = "íšŒì›ê°€ì…";
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("signupForm").style.display = "block";
    });

    document.getElementById("showLogin").addEventListener("click", function () {
        document.getElementById("loginModalLabel").innerText = "ë¡œê·¸ì¸";
        document.getElementById("loginForm").style.display = "block";
        document.getElementById("signupForm").style.display = "none";
    });
</script>
<script>
    // "ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
    document.getElementById("showLogin").addEventListener("click", function () {
        $('#loginModal').modal('show'); // ëª¨ë‹¬ì„ ë³´ì´ë„ë¡ ì„¤ì •
    });
</script>
<script>
    // ëª¨ë‹¬ ë¡œê·¸ì¸ í¼ì—ì„œ ì œì¶œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    document.getElementById("loginForm").addEventListener("submit", function(event) {
      event.preventDefault(); // í¼ì˜ ê¸°ë³¸ ë™ì‘ì„ ë§‰ìŠµë‹ˆë‹¤.
      let formData = new FormData(this); // í¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

      // ì„œë²„ì— ì¸ì¦ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
      fetch('/login', {
        method: 'POST',
        body: formData
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Login failed');
        }
        return response.json();
      })
      .then(data => {
      // ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ë˜ì—ˆì„ ë•Œ ì²˜ë¦¬ ë¡œì§ì„ ì‘ì„±í•©ë‹ˆë‹¤.
        console.log('Login successful', data);
        document.getElementById("loginForm").reset(); // í¼ ì´ˆê¸°í™”
        document.getElementById("loginModal").style.display = "none"; // ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
        document.getElementById("loggedInUser").style.display = "block"; // ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        document.getElementById("signinUsername").textContent = data.username; // ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ

        // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById("logoutBtn").addEventListener("click", function() {
        // ì—¬ê¸°ì— ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ë¡œì§ì„ ì‘ì„±í•©ë‹ˆë‹¤.
        console.log('Logout clicked');
        });
      })
      .catch(error => {
        // ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ ë¡œì§ì„ ì‘ì„±í•©ë‹ˆë‹¤.
        console.error('Login failed', error);
        alert('Login failed. Please check your username and password.');
        document.getElementById("loginForm").reset(); // í¼ ì´ˆê¸°í™”
      });
    });
</script>
</body>
</html>